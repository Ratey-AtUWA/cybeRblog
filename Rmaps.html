<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Learning maps in R</title>

<script src="site_libs/header-attrs-2.17/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<link href="site_libs/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-5.1.3/bootstrap.bundle.min.js"></script>
<script src="site_libs/bs3compat-0.4.0/transition.js"></script>
<script src="site_libs/bs3compat-0.4.0/tabs.js"></script>
<script src="site_libs/bs3compat-0.4.0/bs3compat.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">cyboRg</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="code.html">
    <span class="fa fa-project-diagram"></span>
     
    Code
  </a>
</li>
<li>
  <a href="rants.html">
    <span class="fa fa-bell"></span>
     
    Rants
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-address-card"></span>
     
    About
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="social.html">
    <span class="fa fa-twitter"></span>
     
    Social
  </a>
</li>
<li>
  <a href="work.html">
    <span class="fa fa-user-graduate"></span>
     
    UWA
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Learning maps in R</h1>

</div>


<div
id="basic-maps-in-r-with-graphics-elements-plotted-over-tile-backgrounds"
class="section level1">
<h1>Basic maps in R with graphics elements plotted over tile
backgrounds</h1>
<p>This guide shows some of the more common and/or easy ways to make
maps in <strong>R</strong> using map-tile-based backgrounds with data
plotted over the base maps. We introduce <em>coordinate reference
systems</em>, <em>four packages</em> which allow tile-based map drawing,
a few ways of <em>including user data</em>, and an Appendix on simple
<em>coordinate conversion</em>. <br> The intention is to provide options
to plot informative maps, which include the type of data collected in
this unit, relatively simply. We <em>will not</em> cover vector-based
maps, importing GIS shapefiles, interpolation of point data, chloropleth
maps, and many other map plotting methods.</p>
<p><img src="Rmaps_files/figure-html/world%20map%20for%20decoration-1.png" width="45%" style="display: block; margin: auto;" /></p>
<div id="load-packages-needed-to-make-maps" class="section level3">
<h3>load packages needed to make maps</h3>
<p>...also read some <em>data</em> we need for map annotations, make
some <em>colour</em> <em>palettes</em> to use later, and set any
alternative Windows <em>fonts</em>:</p>
<pre class="r"><code>library(sp)
library(sf)
library(maptiles)
library(prettymapr)
library(rosm)
library(ggmap)
library(ggsn)
# un-comment next line if you can run it from the console without crashing R!
# library(OpenStreetMap) </code></pre>
<pre class="r"><code>git &lt;- &quot;https://raw.githubusercontent.com/Ratey-AtUWA/&quot;
afr_map &lt;- read.csv(file=paste0(git,&quot;spatial/main/afr_map_v2.csv&quot;), 
                      stringsAsFactors = TRUE)
places &lt;- read.csv(file=paste0(git,&quot;learningR/main/places.csv&quot;),
                   stringsAsFactors = TRUE)
taita &lt;- data.frame(lon = c(174.967,174.9549,174.9489,174.9521), 
                    lat = c(-41.1761,-41.1812,-41.1831,-41.1838), 
                    name = c(&quot;Tait\u0101 College&quot;, &quot;Tait\u0101 School&quot;,
                          &quot;Fraser Park&quot;,&quot;Home&quot;)) # we need this later...
taita$name &lt;- as.factor(taita$name) # ...and this
pal4lite &lt;- c(&quot;black&quot;, &quot;purple2&quot;, &quot;blue2&quot;, &quot;cyan4&quot;, &quot;forestgreen&quot;, 
              &quot;darkorange&quot;, &quot;gold3&quot;, &quot;red3&quot;, &quot;gray80&quot;, &quot;white&quot;)
pal4liteTransp &lt;- c(&quot;#000000&quot;,&quot;#912CEEb0&quot;,&quot;#0000EEb0&quot;,&quot;#008B8Bb0&quot;,&quot;#228B22b0&quot;,
                    &quot;#CDAD00b0&quot;, &quot;#FF8C00b0&quot;, &quot;#CD0000b0&quot;, &quot;#CCCCCC&quot;, &quot;#FFFFFF&quot;)
pal4dark &lt;- c(&quot;white&quot;, &quot;pink1&quot;, &quot;orange&quot;, &quot;khaki1&quot;, &quot;lightgreen&quot;, &quot;cadetblue1&quot;, 
              &quot;deepskyblue&quot;, &quot;plum&quot;, &quot;gray80&quot;, &quot;black&quot;)
windowsFonts(nar=windowsFont(&quot;Arial Narrow&quot;), monosans=windowsFont(&quot;Consolas&quot;))</code></pre>
<p>Code to read data from csv file on website into an R data frame:</p>
<pre class="r"><code>## # afs19 &lt;- read.table(&#39;clipboard&#39;, header=T, sep=&quot;\t&quot;, stringsAsFactors = TRUE)
# alternative code reading data from a file:
afs19 &lt;- read.csv(file=paste0(git,&quot;learningR/main/afs19.csv&quot;), 
                  stringsAsFactors = TRUE) # use this one
afs22 &lt;- read.csv(file=paste0(git,&quot;learningR/main/afs22S1.csv&quot;), 
                  stringsAsFactors = TRUE)</code></pre>
</div>
<div id="preparing-to-make-maps" class="section level2">
<h2>Preparing to make maps</h2>
<p>First we define some commonly-used coordinate reference systems which
define the projection of our GPS data</p>
<pre class="r"><code>LongLat &lt;- CRS(&quot;+proj=longlat +ellps=WGS84 
           +datum=WGS84 +no_defs&quot;) # uses Earth ellipsis specs from WGS84 datum
UTM50 &lt;- CRS(&quot;+proj=utm +zone=50 +south&quot;) # just for Zone 50, S hemisphere!</code></pre>
<p>We will use these coordinate reference system objects later. For now
we're going to work in UTM coordinates.</p>
<p>Next we'll convert our data frames to <em>Simple Features</em>
spatial data, using the <strong>R</strong> package <span
style="font-family: monospace; background-color:#e8e8e8;">sf</span>
(Pebesma, 2018). Simple Features is a formal standard (ISO 19125-1:2004)
that describes how objects in the real world can be represented in
computers - see <a
href="https://r-spatial.github.io/sf/articles/sf1.html"
class="uri">https://r-spatial.github.io/sf/articles/sf1.html</a>.</p>
<p>We also make equivalents of these two sf-dataframes in the
longitude--latitiude coordinate system, using the <span
style="font-family: monospace; background-color: #e8e8e8;">st_transform</span>
function.</p>
<pre class="r"><code>afs19utm &lt;- st_as_sf(afs19[-9,], # omitting row 9 where coordinates are missing
                     coords = c(&quot;Easting&quot;,&quot;Northing&quot;),
                     crs = UTM50)
afs22utm &lt;- st_as_sf(afs22, coords = c(&quot;Easting&quot;,&quot;Northing&quot;),
                     crs = UTM50)
afs19ll &lt;- st_transform(afs19utm, crs = LongLat)
afs21ll &lt;- st_transform(afs19utm, crs = LongLat)</code></pre>
<hr>
</div>
<div id="alternative-1----maps-in-r-using-the-maptiles-package"
class="section level2">
<h2>Alternative 1 -- Maps in R using the maptiles package</h2>
<div id="defining-the-mapped-area" class="section level3">
<h3>Defining the mapped area</h3>
<p>We define the area we need for our map and save it in a simple
features object called <span
style="font-family: monospace; background-color:#e8e8e8;">extent</span>.</p>
<p>An easy way to get bounding coordinates (in longitude, latitude) is
by using Google Maps or Google Earth. Google Earth allows the option to
set the coordinate system to UTM. If we generate latitude--longitude
coordinates, we would need to convert our <em>Simple Features</em>
object (see the <strong>Appendix</strong>). If our input coordinates are
Longitude--Latitude, note that south latitudes (and west longitudes) are
negative, and we want decimal degrees rather than
degrees-minutes-seconds. Also note that coordinates from Google Maps and
Google Earth (except in saved <span
style="font-family: monospace;">.kml</span> files) are in the order
(Latitude, Longitude); <em>i.e</em>. <span
class="math inline">\((y,x)\)</span>, whereas <span
class="math inline">\((x,y)\)</span> (Longitude, Latitude) seems to make
more sense.</p>
<p>For coordinates in the <span
style="font-family: monospace; background-color:#e8e8e8;">sf</span> and
<span
style="font-family: monospace; background-color:#e8e8e8;">maptiles</span>
packages, <span class="math inline">\(x\)</span> coordinates are
commonly Eastings or Longitudes, and <span
class="math inline">\(y\)</span> coordinates are commonly Northings or
Latitudes.</p>
<pre class="r"><code>extent &lt;- st_as_sf(data.frame(x=c(399800,400700),y=c(6467900,6468400)),
                   coords = c(&quot;x&quot;,&quot;y&quot;), crs = UTM50)</code></pre>
<p><strong>NOTE</strong>: The projection we specify here will be the one
the map plots in!</p>
</div>
<div id="getting-the-map-tile-data" class="section level3">
<h3>Getting the map tile data</h3>
<p>We now need some functions from the <span
style="font-family: monospace; background-color:#e8e8e8;">maptiles</span>
package (Giraud 2021). We're using one of the OpenStreetMap tile
options, but the following tile providers also work: <br> <span
style="font-family: monospace; background-color:#e8e8e8;">OpenStreetMap,
OpenStreetMap.HOT, Esri.WorldStreetMap, Esri.WorldTopoMap,
Esri.WorldImagery, Esri.WorldGrayCanvas, Stamen.Toner,
Stamen.TonerBackground, Stamen.TonerHybrid, Stamen.TonerLines,
Stamen.TonerLabels, Stamen.TonerLite, CartoDB.Positron,
CartoDB.DarkMatter, CartoDB.Voyager</span> (all CartoDB... tiles have
variants which work), and <span
style="font-family: monospace; background-color:#e8e8e8;">OpenTopoMap</span>
<br> The option <span
style="font-family: monospace; background-color:#e8e8e8;">crop =
TRUE</span> is included to crop the tiles to our defined area in the
<span
style="font-family: monospace; background-color:#e8e8e8;">extent</span>
object. If we leave it out, the map may change shape as it will use only
square (uncropped) map tiles.</p>
<pre class="r"><code># NOTE: projection of input object e.g. &#39;extent&#39; sets map projection
aftiles &lt;- get_tiles(extent, provider = &quot;OpenStreetMap.HOT&quot;, crop = TRUE)</code></pre>
</div>
<div id="plotting-the-map" class="section level3">
<h3>Plotting the map</h3>
<p>The 'aftiles' object we created is a 'SpatRaster' object which needs
the maptiles package loaded to be able to plot it. We need to set the
outer margins of the plot area (by default they are zeros) to allow
plotting of axes <em>etc</em> -- see Figure 1.</p>
<pre class="r"><code>par(oma=c(3,3,1,1), lend=&quot;square&quot;)
plot(aftiles)

box(lwd=6,col=&quot;white&quot;) # tidies up skewness of UTM tiles a bit
axis(1, tcl=-0.2, mgp = c(1.6,0.3,0))
mtext(&quot;Easting (UTM Zone 50, m)&quot;, side = 1, line = 1.5, font=2)
axis(2, tcl=-0.2, mgp = c(1.6,0.3,0))
mtext(&quot;Northing (UTM Zone 50, m)&quot;, side = 2, line = 1.5, font=2)
box()</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/plot-map1-axes-1.png" alt="Figure 1. Map of Ashfield Flats in the UTM projection, generated using the maptiles R package, with OpenStreetMap tiles." width="70%" />
<p class="caption">
Figure 1. Map of Ashfield Flats in the UTM projection, generated using
the maptiles R package, with OpenStreetMap tiles.
</p>
</div>
<p>The next chunk of code adds the <span
style="font-family: monospace; background-color: #e8e8e8;">prettymapr</span>
features shown in Figure 2. In this code, <span
style="font-family: monospace; background-color: #e8e8e8;">plotepsg =
32750</span> refers to the EPSG code for the UTM projection in Zone 50
(EPSG 32750), which we need so that the scale bar shows the correct
distances. (Long-Lat is EPSG 4326 in WGS84)</p>
<pre class="r"><code># . . . continuing previous code . . .
addnortharrow(text.col=1, border=1)
addscalebar(plotepsg = 32750, label.col = 1, linecol = 1, 
            label.cex = 1.2, htin=0.15, widthhint = 0.15)</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/map-north-scale-1.png" alt="Figure 2. Map of Ashfield Flats (UTM), with added North arrow and scale bar from prettymapr, over OpenStreetMap tiles acquired using maptiles." width="70%" />
<p class="caption">
Figure 2. Map of Ashfield Flats (UTM), with added North arrow and scale
bar from prettymapr, over OpenStreetMap tiles acquired using maptiles.
</p>
</div>
</div>
<div id="adding-our-data-and-map-annotations" class="section level3">
<h3>Adding our data and map annotations</h3>
<p>Very often we would like to <strong>add our own information to a
map</strong>, such as the location of samples, often with different
sizes, shapes, or colours of symbols to represent numerical
information.</p>
<p>Since we have a map in UTM coordinates, we can now add plots of our
data based on UTM locations (with a legend, of course -- see Figure 3).
We can plot the points from the non-spatial data frame <span
style="font-family: monospace; background-color: #e8e8e8;">afs19</span>,
but here we <span
style="font-family: monospace; background-color: #e8e8e8;">plot</span>
the points from <span
style="font-family: monospace; background-color: #e8e8e8;">afs19utm</span>,
with the <span
style="font-family: monospace; background-color: #e8e8e8;">add=TRUE</span>
option. We add a legend to the plot in the usual way.</p>
<pre class="r"><code># . . . continuing from previous code . . .
with(afs19utm, plot(geometry, add=TRUE, lwd = 2, 
                    pch = c(0,1,2,3,5,6,15,17,18,19)[Group], 
                    col = rainbow(10,v=0.6,end=0.75)[Group]))
legend(&quot;bottomright&quot;, legend=levels(as.factor(afs19$Group)),
       pch = c(0,1,2,3,5,6,15,17,18,19), col = rainbow(10,v=0.6,end=0.75),
       pt.lwd = 2, title = &quot;Group&quot;, inset = 0.02, ncol = 2)</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/add-data-1.png" alt="Figure 3. Map of Ashfield Flats (UTM), with added North arrow, scale bar, and user data, over OpenStreetMap tiles acquired using maptiles." width="70%" />
<p class="caption">
Figure 3. Map of Ashfield Flats (UTM), with added North arrow, scale
bar, and user data, over OpenStreetMap tiles acquired using maptiles.
</p>
</div>
<p>We can also add digitized map features such as wetland ponds, drains,
<em>etc</em>., if these are not on the map tiles already. Ideally we
would add these <strong>before</strong> plotting the data, to avoid the
type of overplotting shown in Figure 4.</p>
<pre class="r"><code># . . . continuing from previous code . . .
with(afr_map, lines(drain_E, drain_N, col = &quot;cadetblue&quot;, lwd = 2))
with(afr_map, lines(wetland_E, wetland_N, col = &quot;cadetblue&quot;, lwd = 1, lty = 2))</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/map-annot-1.png" alt="Figure 4. Map of Ashfield Flats (UTM), with added North arrow, scale bar, user data, and additional map items, over OpenStreetMap tiles acquired using maptiles." width="652.8" />
<p class="caption">
Figure 4. Map of Ashfield Flats (UTM), with added North arrow, scale
bar, user data, and additional map items, over OpenStreetMap tiles
acquired using maptiles.
</p>
</div>
<p>Finally, we would most likely want to add some text. Text labels
should also be added <em>before</em> plotting the data. The final map is
shown in Figure 5.</p>
<pre class="r"><code># . . . continuing from previous code . . .
text(c(400263, 399962, 400047), c(6468174, 6468083, 6468237),
     labels = c(&quot;Chapman Drain&quot;,&quot;Kitchener Drain&quot;, &quot;Woolcock Drain&quot;),
     pos = c(2,2,4), cex = 0.8, font = 3, col = &quot;cadetblue&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/map-text-labels-1.png" alt="Figure 5. Map of Ashfield Flats (UTM), with added North arrow, scale bar, user data, and additional map items plus text labels, over OpenStreetMap tiles acquired using maptiles." width="652.8" />
<p class="caption">
Figure 5. Map of Ashfield Flats (UTM), with added North arrow, scale
bar, user data, and additional map items plus text labels, over
OpenStreetMap tiles acquired using maptiles.
</p>
</div>
</div>
<div id="making-a-bubble-map" class="section level3">
<h3>Making a bubble map</h3>
<p>We use essentially the same code as for the maps above (except
plotting the annotations and data in the correct order!). Then we use
the <span
style="font-family: monospace; background-color: #e8e8e8;">symbols()</span>
function to make the 'bubbles', making sure that we include the options
<span style="font-family: monospace; background-color: #e8e8e8;">add =
TRUE</span> so we overplot the map, and <span
style="font-family: monospace; background-color: #e8e8e8;">inches =
FALSE</span> so we can manually scale the bubbles. The factor of <span
style="font-family: monospace; background-color: #e8e8e8;">0.4</span>
used to scale the circles in the code for bubbles and legend is
<em>found by trial-and-error</em> (it <em>is</em> possible to write an
algorithm to estimate a scaling factor from the data). A map like that
shown in Figure 6 is a good exploratory data analysis tool, as even
without the legend it shows any unevenness in concentrations, including
where high concentrations are located.</p>
<pre class="r"><code>par(oma=c(3,3,1,1), lend=&quot;square&quot;)
plot(aftiles)
box(lwd=6,col=&quot;white&quot;) # tidies up skewness of UTM tiles a bit
axis(1, tcl=-0.2, mgp = c(1.6,0.3,0))
mtext(&quot;Easting (UTM Zone 50, m)&quot;, side = 1, line = 1.5, font=2)
axis(2, tcl=-0.2, mgp = c(1.6,0.3,0))
mtext(&quot;Northing (UTM Zone 50, m)&quot;, side = 2, line = 1.5, font=2)
box()
with(afr_map, lines(drain_E, drain_N, col = &quot;cadetblue3&quot;, lwd = 2))
with(afr_map, lines(wetland_E, wetland_N, col = &quot;cadetblue3&quot;, lwd = 1, lty = 2))
text(c(400263, 399962, 400047), c(6468174, 6468083, 6468237),
     labels = c(&quot;Chapman Drain&quot;,&quot;Kitchener Drain&quot;, &quot;Woolcock Drain&quot;),
     pos = c(2,2,4), cex = 0.8, font = 3, col = &quot;cadetblue&quot;)
addnortharrow(text.col=1, border=1)
addscalebar(plotepsg = 32750, label.col = 1, linecol = 1, 
            label.cex = 1.2, htin=0.15, widthhint = 0.15)
# plot bubbles using the symbols() function
with(afs19, symbols(Easting, Northing, add = TRUE, circles = 0.4*sqrt(Zn),
                    inches = FALSE, fg = &quot;purple&quot;, bg = &quot;#8000FF40&quot;))
# manual legend
if (pretty(afs19$Zn)[1] &lt; 0.001) {
  bublo &lt;- pretty(afs19$Zn)[2]/2
} else {
  bublo &lt;- pretty(afs19$Zn)[1]
}
bubhi &lt;- pretty(afs19$Zn)[NROW(pretty(afs19$Zn))]
symbols(c(400600,400600),c(6468040,6467980), circles=0.4*sqrt(c(bublo,bubhi)), add=T,
        lwd=1, inches=F, fg = &quot;purple&quot;, bg = &quot;#8000FF40&quot;)
text(c(400600,400620,400620),c(6468100,6468040,6467980), 
     labels=c(&quot;Zn (mg/kg)&quot;,bublo,bubhi), cex=0.85, pos = c(1,4,4))</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/map-bubbles-1.png" alt="Figure 6. Bubble map of zinc concentrations in sediment and soil at Ashfield Flats in 2019, over OpenStreetMap tiles acquired using maptiles." width="70%" />
<p class="caption">
Figure 6. Bubble map of zinc concentrations in sediment and soil at
Ashfield Flats in 2019, over OpenStreetMap tiles acquired using
maptiles.
</p>
</div>
</div>
<div id="categorized-e.g.-percentile-bubble-map" class="section level3">
<h3>Categorized (<em>e.g</em>. percentile) bubble map</h3>
<p>We make a new column in our data frame by cutting the measurement of
interest, in this example <strong>Zn</strong>, into percentiles. The new
column called <span
style="font-family: monospace; background-color: #e8e8e8;">QZn</span> is
a factor which identifies which percentile of Zn concentration each
sample is in. We then use this factor to define symbols, sizes, and
colours for each sample location. We add a line break to text labels
using <span
style="font-family: monospace; background-color: #e8e8e8;"><span
class="math inline">\(\backslash\)</span>n</span>.</p>
<pre class="r"><code>par(oma=c(3,3,1,1), lend=&quot;square&quot;)
plot(aftiles)
box(lwd=6,col=&quot;white&quot;) # tidies up skewness of UTM tiles a bit
axis(1, tcl=-0.2, mgp = c(1.6,0.3,0))
mtext(&quot;Easting (UTM Zone 50, m)&quot;, side = 1, line = 1.5, font=2)
axis(2, tcl=-0.2, mgp = c(1.6,0.3,0))
mtext(&quot;Northing (UTM Zone 50, m)&quot;, side = 2, line = 1.5, font=2)
box()
with(afr_map, lines(drain_E, drain_N, col = &quot;cadetblue3&quot;, lwd = 2))
with(afr_map, polygon(wetland_E, wetland_N, col = &quot;cadetblue2&quot;, 
                      border = &quot;cadetblue3&quot;))
text(c(400263, 399962, 400047), c(6468174, 6468083, 6468237),
     labels = c(&quot;Chapman\nDrain&quot;,&quot;Kitchener\nDrain&quot;, &quot;Woolcock\nDrain&quot;),
     pos = c(2,2,4), cex = 0.8, font = 3, col = &quot;cadetblue&quot;)
addnortharrow(text.col=1, border=1)
addscalebar(plotepsg = 32750, label.col = 1, linecol = 1, 
            label.cex = 1.2, htin=0.15, widthhint = 0.15)
# percentile plot
afs19$QZn &lt;- cut(afs19$Zn, quantile(afs19$Zn, 
                 p=c(0,0.02,0.05,0.25,0.5,0.75,0.95,0.98,1), 
                 na.rm=T), labels=c(&quot;Q0-02&quot;,&quot;Q02-05&quot;,&quot;Q05-25&quot;,&quot;Q25-50&quot;,
                                    &quot;Q50-75&quot;,&quot;Q75-95&quot;,&quot;Q95-98&quot;,&quot;Q98-max&quot;))
palette(pal4liteTransp) # use colours with semi-transparency (defined near top)
# use percentile factor column to categorize points
with(afs19, 
     points(Easting, Northing, 
            pch = c(22,22,22,3,4,21,21,21)[QZn], 
            col = c(1,1,1,4,5,1,1,1)[QZn], bg = c(1:8)[QZn],
            lwd = c(1,1,1,2,2,1,1)[QZn], 
            cex = c(0.5,0.65,0.8,1,1,1.5,2.2,3)[QZn])
     )
legend(&quot;bottomright&quot;, legend = levels(afs19$QZn), title=&quot;Zn&quot;,
       pch = c(22,22,22,3,4,21,21,21), col = c(1,1,1,4,5,1,1,1),
       pt.lwd = c(1,1,1,2,2,1,1), pt.bg = c(1:8), 
       pt.cex = c(0.5,0.65,0.8,1,1,1.5,2.2,3),
       bty = &quot;n&quot;, inset = 0.02, cex = 0.85, y.intersp = 1.2)</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/PctBubb-1.png" alt="Figure 7. Map showing percentile ranges of zinc concentrations in sediment and soil at Ashfield Flats in 2019, over OpenStreetMap tiles acquired using maptiles." width="70%" />
<p class="caption">
Figure 7. Map showing percentile ranges of zinc concentrations in
sediment and soil at Ashfield Flats in 2019, over OpenStreetMap tiles
acquired using maptiles.
</p>
</div>
<pre class="r"><code>palette(pal4lite) # change back to non-transparent palette (optional)
afs19$QZn &lt;- NULL # to delete quantile column (optional; you can leave it in)</code></pre>
<p>The resulting percentile bubble map (Figure 7) adds value to the
'standard' bubble map (Figure 6), as it adds some statistical meaning to
the bubble sizes. A similar map could be created by using the Tukey
boxplot thresholds instead of percentiles which could show potential
outliers (<em>i.e</em>. using the <span
style="font-family: monospace; background-color: #e8e8e8;">boxplot.stats()</span>
function to generate categories instead of the <span
style="font-family: monospace; background-color: #e8e8e8;">quantile()</span>
function.)</p>
<hr>
</div>
</div>
<div id="alternative-2----maps-in-r-using-the-ggmap-package"
class="section level2">
<h2>Alternative 2 -- Maps in R using the ggmap package</h2>
<p>The <span
style="font-family: monospace; background-color: #e8e8e8;">ggmap</span>
package (Kahle and Wickham 2013) is an extension of <span
style="font-family: monospace; background-color: #e8e8e8;">ggplot</span>,
so it's easier to use if you are familiar with <span
style="font-family: monospace; background-color: #e8e8e8;">ggplot</span>
and the associated family of packages. <span
style="color: #A00000;"><em>You need to register for and obtain</em>
<em>your own Google maps key to run this code!</em></span></p>
<p>First we make a <span
style="font-family: monospace; background-color: #e8e8e8;">ggmap</span>
object, locating the map by its central coordinate with the extent
controlled by the <span
style="font-family: monospace; background-color: #e8e8e8;">zoom</span>
option:</p>
<pre class="r"><code>## library(ggmap)
register_google(key = secret) # you need your own Google Maps API code
udubua.gg &lt;- get_googlemap(center=c(115.8213,-31.98165), 
                           zoom = 16, maptype = &quot;terrain&quot;, color = &quot;bw&quot;)</code></pre>
<p>Next we plot the ggmap object using ggplot grammar. It's possible to
just plot the object (<em>i.e</em>. run <span
style="font-family: monospace;  background-color: #e8e8e8;">ggmap(udubua.gg)</span>),
but it's good to have more control over plot options
<strong>and</strong> to plot some data over the base map. In the example
in Figure 8, we use the aesthetic in <span
style="font-family: monospace; background-color: #e8e8e8;">geom_point()</span>
to plot different categories with different shapes and colours, with the
categories defined by the factor <span
style="font-family: monospace; background-color: #e8e8e8;">Type</span>.
A range of map styles is available by selecting a combination of one of
<span style="font-family: monospace; background-color: #e8e8e8;">maptype
= "terrain", "satellite", "roadmap"</span>, or <span
style="font-family: monospace; background-color: #e8e8e8;">"hybrid"</span>,
together with <span
style="font-family: monospace; background-color: #e8e8e8;">color =
"color"</span> or <span
style="font-family: monospace; background-color: #e8e8e8;">"bw"</span>.
Note: the <span
style="font-family: monospace; background-color: #e8e8e8;">ggsm</span>
package is designed to add scale bar and north arrow to ggmaps, but it
seems buggy and we currently don't recommend it.</p>
<pre class="r"><code>ggmap(udubua.gg) + 
  labs(y=&quot;Latitude (\u00B0S)&quot;, x = &quot;Longitude (\u00B0E)&quot;) + 
  geom_text(aes(x = 115.825, y = -31.98, label = &quot;Swan\nRiver&quot;,
                fontface = &quot;italic&quot;, family=&quot;sans&quot;), 
            size = 4, vjust = 0, hjust = 0, color=&quot;gray40&quot;) + 
  geom_point(aes(x = Longitude, y = Latitude, col=Type, shape=Type), 
             data = places, size=3) +
  theme(axis.text=element_text(size=9, color=&quot;black&quot;),
        axis.title=element_text(size=11,face=&quot;bold&quot;))</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/ggmap1-1.png" alt="Figure 8. Map of the University of Western Australia campus at Crawley, showing the location of libraries and cafés, plotted over Google maps tiles acquired using the R package ggmap." width="75%" />
<p class="caption">
Figure 8. Map of the University of Western Australia campus at Crawley,
showing the location of libraries and cafés, plotted over Google maps
tiles acquired using the R package ggmap.
</p>
</div>
<p>There are numerous possibilities with <span
style="font-family: monospace; background-color: #e8e8e8;">ggmap</span>
and the features made possible by <span
style="font-family: monospace; background-color: #e8e8e8;">ggplot2</span>
that are not illustrated by Figure 8. For example, we could use <span
style="font-family: monospace; background-color: #e8e8e8;">size</span>
as an aesthetic (<em>i.e</em>. include within <span
style="font-family: monospace; background-color: #e8e8e8;">aes(...)</span>
with <span
style="font-family: monospace; background-color: #e8e8e8;">size =
variableName</span>), to generate something like a bubble map. Although
there is an option to set the map size (and therefore aspect ratio) in
the <span
style="font-family: monospace; background-color: #e8e8e8;">get</span>_<span
style="font-family: monospace; background-color: #e8e8e8;">googlemap</span>,
we have found that this doesn't work consistently, so we recommend
leaving the map dimensions and aspect ratio at their default values.</p>
<div id="other-map-types-using-ggmap" class="section level3">
<h3>Other map types using ggmap</h3>
<p>Another option currently implemented in <span
style="font-family: monospace; background-color: #e8e8e8;">ggmap</span>
are some of the <em>Stamen</em> map tiles, accessible with the <span
style="font-family: monospace; background-color: #e8e8e8;">get</span>_<span
style="font-family: monospace; background-color: #e8e8e8;">stamenmap()</span>
function.</p>
<ul>
<li>The Stamen "terrain" tiles seem to be available up to <span
style="font-family: monospace; background-color: #e8e8e8;">zoom =
13</span>, and are good for showing maps at the scale of 1-2 suburbs or
a small town (Figure 9), with 'hill shading' to show terrain.</li>
<li>The Stamen toner variants are minimalist maps which are good at
de-emphasizing the base map background to emphasise added data (see the
example in Figure 10).</li>
<li>The Stamen "watercolor" tiles are also available.</li>
</ul>
<pre class="r"><code>tai_Stamen &lt;- get_stamenmap(bbox=c(left=174.9, bottom = -41.2,
                                   right = 175.0, top = -41.15),
                            zoom=13, # seems to be max zoom
                            maptype = &quot;terrain&quot;, color = &quot;color&quot;)
ggmap(tai_Stamen) + 
  labs(y=&quot;Latitude (\u00B0S)&quot;, x = &quot;Longitude (\u00B0E)&quot;) + 
  geom_rect(aes(xmin=174.94, xmax=174.96, ymin=-41.178,ymax=-41.188),
               colour=&quot;red3&quot;, fill=NA, size=1.2) +
  geom_text(aes(x = 174.961, y = -41.183, label = &quot;live\nplay\nschool&quot;,
                fontface = &quot;bold&quot;, family=&quot;mono&quot;), 
            size = 5, vjust = 0.5, hjust = 0, color=&quot;red3&quot;, lineheight=0.8) +
  geom_text(aes(x = 174.91, y = -41.16, 
                label = paste(&quot;(author&#39;s childhood neighbourhood,\n&quot;,
                              &quot;Tait\u0101,&quot;,&quot;Aotearoa New Zealand)&quot;),
                fontface = &quot;italic&quot;, family=&quot;serif&quot;),
            size = 4.5, lineheight=0.8, vjust = 0, hjust = 0, color=&quot;#004000&quot;) +
  geom_point(aes(x = lon, y = lat, color=name), data=taita, size = 4) +
  scale_color_manual(values = c(&quot;navy&quot;,&quot;goldenrod&quot;,&quot;darkorchid&quot;,&quot;seagreen&quot;)) +
  theme(axis.text=element_text(size=9, color=&quot;black&quot;),
        axis.title=element_text(size=11,face=&quot;bold&quot;)) + 
  theme_bw()</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/ggStamenNZ-1.png" alt="Figure 9. Map of the central Hutt Valley, New Zealand, plotted with Stamen terrain map tiles acquired using the R package ggmap." width="80%" />
<p class="caption">
Figure 9. Map of the central Hutt Valley, New Zealand, plotted with
Stamen terrain map tiles acquired using the R package ggmap.
</p>
</div>
<p><span style="size: 14pt"><strong>The next example</strong></span>
(Figure 10) uses the simple features information in one of the data
frames we made at the beginning. The <span
style="font-family: monospace; background-color: #e8e8e8;">sf</span>
package introduces a new 'geom', <span
style="font-family: monospace; background-color: #e8e8e8;">geom_sf()</span>
for plotting in <span
style="font-family: monospace; background-color: #e8e8e8;">ggmap</span>.
We need to use the option <span
style="font-family: monospace; background-color: #e8e8e8;">inherit.aes =
FALSE</span> in <span
style="font-family: monospace; background-color: #e8e8e8;">geom_sf</span>,
to overrides the default aesthetics from the <span
style="font-family: monospace; background-color: #e8e8e8;">ggmap</span>
object. We also add <span
style="font-family: monospace; background-color: #e8e8e8;">coord_sf</span>
to ensure that all layers use a common CRS (<u>C</u>oordinate
<u>R</u>eference <u>S</u>ystem). Run <span
style="font-family: monospace; background-color: #e8e8e8;">help(geom_sf)</span>
for more information.</p>
<pre class="r"><code>afr.gg &lt;- get_stamenmap(bbox=c(left=115.941, bottom = -31.92,
                                   right = 115.948, top = -31.916), 
                        zoom=17, col = &quot;bw&quot;,maptype = &quot;toner-lite&quot;)
ggmap(afr.gg) + 
  labs(y=&quot;Latitude (\u00B0S)&quot;, x = &quot;Longitude (\u00B0E)&quot;) + 
  geom_text(aes(x = 115.944, y = -31.918, label = &quot;Ashfield\nFlats&quot;,
                fontface = &quot;italic&quot;, family=&quot;sans&quot;), 
            size = 4, color=&quot;gray65&quot;, lineheight=0.8) +
  geom_text(aes(x = 115.942, y = -31.9199, label = &quot;Swan River&quot;,
                fontface=&quot;italic&quot;, family=&quot;sans&quot;), size=4, color=&quot;gray65&quot;) +
  geom_path(aes(x = drain_lon, y=drain_lat), data=afr_map, 
            color = &quot;slategray2&quot;, size = 1.25) +
  geom_polygon(aes(x=wetland_lon, y=wetland_lat), data = afr_map,
               color = &quot;slategray&quot;, fill=&quot;azure3&quot;) + 
  geom_sf(data = afs21ll, aes(bg=Zn, size=Zn), shape=21, inherit.aes = FALSE) +
  scale_fill_viridis_c(alpha = 0.7) + 
  scale_size_area(breaks = c(30,100,300,1000,3000,5000), max_size = 9) +
  theme_bw() +
  theme(axis.title = element_text(size = 12, face = &quot;bold&quot;)) +
  coord_sf(crs = st_crs(4326))</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/ggStamenAF-1.png" alt="Figure 10. Zinc concentration (mg/kg) in sediment sampled in Semester 1, 2021 at Ashfield Flats, Western Australia, plotted over Stamen toner-lite map tiles acquired using the R package ggmap, with data in a simple features data frame, and with manually added wetland pond locations." width="70%" />
<p class="caption">
Figure 10. Zinc concentration (mg/kg) in sediment sampled in Semester 1,
2021 at Ashfield Flats, Western Australia, plotted over Stamen
toner-lite map tiles acquired using the R package ggmap, with data in a
simple features data frame, and with manually added wetland pond
locations.
</p>
</div>
<hr>
</div>
</div>
<div id="alternative-3----the-rosm-package" class="section level2">
<h2>Alternative 3 -- the 'rosm' package</h2>
<p>The rosm package (Dunnington 2022) allows users to produce background
maps from several map tile providers.</p>
<p>The following map tile types seem to work using <span
style="font-family: monospace; background-color: #e8e8e8;">osm.plot()</span>
in the <span
style="font-family: monospace; background-color: #e8e8e8;">rosm</span>
package: <br><span
style="font-family: monospace; background-color: #e8e8e8;">"osm",
"hotstyle", "stamenbw", "stamenwatercolor", "cartodark",
"cartolight"</span></p>
<p>The following map tile types seem to work using <span
style="font-family: monospace; background-color: #e8e8e8;">bmaps.plot()</span>
in the <span
style="font-family: monospace; background-color: #e8e8e8;">rosm</span>
package:<br> <span
style="font-family: monospace; background-color: #e8e8e8;">"Aerial",
"AerialWithLabels"</span></p>
<pre class="r"><code>par(mar = c(.1,.1,.1,.1), mgp = c(1.7,0.3,0), lend=2, ljoin=1, tcl=0.25)

# specify limits of map in order N, E, S, W
udubua.rosm &lt;- makebbox(-31.9751,115.8284,-31.9882,115.8143)

# plot an osm-type map
osm.plot(udubua.rosm, type=&quot;cartolight&quot;, zoomin=0)

# add some points to the plot
osm.points(c(115.82, 115.8186, 115.8211, 115.8182, 115.8184), 
           c(-31.9835, -31.9829, -31.9821, -31.9790, -31.9765), 
           col=&quot;purple&quot;, lwd=2, pch=7, cex=1.5)
box(which = &quot;plot&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/rosmLight-1.png" alt="Figure 11. UWA campus map using cartolight tiles acquired using the rosm package." width="35%" />
<p class="caption">
Figure 11. UWA campus map using cartolight tiles acquired using the rosm
package.
</p>
</div>
<pre><code>## 
  |                                                                                                        
  |                                                                                                  |   0%
  |                                                                                                        
  |========================                                                                          |  25%
  |                                                                                                        
  |=================================================                                                 |  50%
  |                                                                                                        
  |==========================================================================                        |  75%
  |                                                                                                        
  |==================================================================================================| 100%</code></pre>
<p>The map in Figure 11 uses the <span
style="font-family: monospace; background-color: #e8e8e8;">cartolight</span>
map tile style to produce a base map with light colours -- this can be
useful when we are trying to emphasise the data rather than the map
features.</p>
<div id="another-option-using-a-bing-map-as-background"
class="section level3">
<h3>another option using a Bing map as background</h3>
<pre class="r"><code>bmaps.plot(udubua.rosm, type=&quot;AerialWithLabels&quot;, zoomin=0)
osm.points(c(115.82, 115.8186, 115.8211, 115.8182, 115.8184), 
           c(-31.9835, -31.9829, -31.9821, -31.9790, -31.9765), 
           col=&quot;yellow&quot;, lwd=2, pch=10, cex=1.5)
osm.text(c(115.825,115.826), c(-31.98, -31.988),
         labels = c(&quot;Matilda\nBay&quot;, &quot;Pelican Point&quot;),
         col = c(&quot;powderblue&quot;,&quot;honeydew&quot;), font = 3, cex = 0.75)</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/rosmAerial-1.png" alt="Figure 12. UWA campus map using Bing tiles acquired using the rosm package." width="35%" />
<p class="caption">
Figure 12. UWA campus map using Bing tiles acquired using the rosm
package.
</p>
</div>
<pre><code>## 
  |                                                                                                        
  |                                                                                                  |   0%
  |                                                                                                        
  |========================                                                                          |  25%
  |                                                                                                        
  |=================================================                                                 |  50%
  |                                                                                                        
  |==========================================================================                        |  75%
  |                                                                                                        
  |==================================================================================================| 100%</code></pre>
<p>As shown by the output in Figure 12, the Bing map tiles are aerial
photographs. Sometimes this is useful for showing features like
vegetation <em>etc</em>. on the base map.</p>
</div>
<div id="embedding-rosm-functions-inside-prettymap"
class="section level3">
<h3>embedding rosm functions inside prettymap()</h3>
<pre class="r"><code>prettymap({
  osm.plot(udubua.rosm, type=&quot;stamenbw&quot;, zoomin = -1)
  osm.points(c(115.82, 115.8186, 115.8211, 115.8182, 115.8184), 
             c(-31.9835, -31.9829, -31.9821, -31.9790, -31.9765), 
             col=&quot;red&quot;, lwd=3, pch = 15, cex=1.5)
  osm.text(115.825, -31.98, labels = &quot;Matilda\nBay&quot;, 
           font = 3, col = &quot;azure&quot;)
  osm.text(115.824, -31.9865, labels = &quot;Pelican Point&quot;, 
           font = 3, col = &quot;navy&quot;)
},
oma = c(3,3,1,1), drawarrow = T, arrow.scale = 1, 
arrow.border = &quot;pink&quot;, arrow.text.col = &quot;pink&quot;,
scale.htin = 0.15, scale.label.cex = 1.2, scale.label.col = &quot;pink&quot;, 
scale.linecol = &quot;pink&quot;, scale.pos = &quot;bottomright&quot;
)
legend(&quot;right&quot;, legend = &quot;Coffee is\nfound here&quot;,
       pch = 15, col = &quot;red&quot;,
       inset = 0.02, cex = 0.9, pt.cex = 1,
       x.intersp = 0.5, y.intersp=0.7)
axis(1,tcl=-0.2); axis(2,tcl=-0.2)</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/rosmPretty-1.png" alt="Figure 13. UWA campus map using Stamen-toner tiles acquired using the rosm package, and illustrating the axis problem." width="45%" />
<p class="caption">
Figure 13. UWA campus map using Stamen-toner tiles acquired using the
rosm package, and illustrating the axis problem.
</p>
</div>
<pre><code>## 
  |                                                                                                        
  |                                                                                                  |   0%
  |                                                                                                        
  |=================================================                                                 |  50%
  |                                                                                                        
  |==================================================================================================| 100%</code></pre>
<p>It's helpful to include a scale and North arrow on the plot, but the
axes in Figure 13, however, are in web Mercator coordinates (and are
messy). This is a problem with no easy fix. Either we don't include axes
(not ideal, since we should show some coordinates), figure out how to
plot them, or use another package.</p>
<hr>
</div>
</div>
<div
id="alternative-4---use-the-openstreetmap-package-to-make-an-initial-map-object"
class="section level2">
<h2>Alternative 4 - use the OpenStreetMap package to make an initial map
object</h2>
<p>We can also use the <span
style="font-family: monospace; background-color: #e8e8e8;">OpenStreetMap</span>
R package (Fellows, 2019) to make a plot-able map object, based on the
coordinates which bound a rectangular area. We need the north-west
(upper left) and south-east (lower right) coordinates of the rectangular
map we want to plot. (<strong>Note</strong> that the coordinates are in
the order (Latitude, Longitude); <em>i.e</em>. <span
class="math inline">\((y,x)\)</span>, whereas <span
class="math inline">\((x,y)\)</span> seems more intuitive.)</p>
<p><strong>Note that <span style="background-color: #FFFF00;">there can
be problems</span> trying</strong> <strong>to use the</strong> <span
style="font-family: monospace; background-color: #e8e8e8;">OpenStreetMap</span>
<strong>package</strong>, especially on Mac/Apple computers. This
relates to the need for a working Java installation (Windows and Mac)
and the requirement for the XQuartz app on Mac OS. Otherwise the <span
style="font-family: monospace; background-color: #e8e8e8;">OpenStreetMap</span>
package can be very useful!</p>
<pre class="r"><code>UWA_osm &lt;- openmap(upperLeft = c(-31.974, 115.812), # latitude first
                   lowerRight = c(-31.988, 115.828), 
                   zoom = 16,
                   type = &quot;osm&quot;)
plot(UWA_osm)</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/UWAosm-1.png" alt="Figure 14. Map of the University of Western Australia Crawley campus using the default OpenStreetMap settings." width="50%" />
<p class="caption">
Figure 14. Map of the University of Western Australia Crawley campus
using the default OpenStreetMap settings.
</p>
</div>
<p>The map in Figure 14 needs some attention. Without some prior
knowledge, we don't know where on Earth's surface this map represents,
we don't know the direction it's oriented in, and we don't know the
scale. We can add a north arrow to indicate direction, a scale bar to
show the scale, and axes to show any coordinates which should show the
location on Earth.</p>
<div id="plot-the-uwa-campus-map-with-margins-axes-and-annotations"
class="section level3">
<h3>Plot the UWA campus map with margins, axes, and annotations</h3>
<pre class="r"><code>require(prettymapr)
par(mar = c(3, 3, 0.5, 0.5), mgp = c(1.6, 0.3, 0), tcl = 0.4)
plot(UWA_osm, removeMargin = FALSE)
axis(1)
axis(2)
addnortharrow()
addscalebar(plotepsg = 3857) # 3857 is EPSG code for web Mercator
box()</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/UWAosm2-1.png" alt="Figure 15. Map of the University of Western Australia Crawley campus showing scale, north arrow, and axes, but retaining some default OpenStreetMap settings." width="50%" />
<p class="caption">
Figure 15. Map of the University of Western Australia Crawley campus
showing scale, north arrow, and axes, but retaining some default
OpenStreetMap settings.
</p>
</div>
<p>The map in Figure 15 is better -- we now know scale and direction,
but finding our location on Earth is tricky because the OpenStreetMap
map projection is "Google Mercator" (<em>a.k.a</em>. "Web Mercator")
which is not a projection most people are familiar with. We need a map
in a commonly-used projection such as Longitude-Latitude, or Universal
Transverse Mercator (UTM). We can change projections using the <span
style="font-family: monospace; background-color: #e8e8e8;">openproj()</span>
function in the OpenStreetMap package.</p>
</div>
<div
id="plot-a-re-projected-uwa-campus-map-in-utm-with-margins-axes-and-annotations"
class="section level3">
<h3>Plot a re-projected UWA campus map in UTM with margins, axes, and
annotations</h3>
<p>First convert the projection...</p>
<pre class="r"><code>require(OpenStreetMap)
UWA_utm &lt;- openproj(UWA_osm, projection = &quot;+proj=utm +zone=50 +south&quot;)
cat(&quot;Show upper left (p1) and lower right (p2) coordinates\n&quot;)
print(UWA_utm$bbox, digits=6) # show bounding coordinates to check</code></pre>
<pre><code>## Show upper left (p1) and lower right (p2) coordinates
## $p1
## [1]  387742 6461857
## 
## $p2
## [1]  389290 6460267</code></pre>
<p><strong>...then plot the map in its new projection.</strong></p>
<pre class="r"><code># plot the map in its new projection
par(mar = c(3, 3, 0.5, 0.5), mgp = c(1.6, 0.3, 0), tcl = 0.4)
plot(UWA_utm, removeMargin = FALSE)
axis(1)
mtext(&quot;Easting (UTM Zone 50, m)&quot;, side = 1, line = 1.6, font = 2, cex = 1.2)
axis(2)
mtext(&quot;Northing (UTM Zone 50, m)&quot;, side = 2, line = 1.6, font = 2, cex = 1.2)
addnortharrow(scale = 1.2)
addscalebar(plotepsg = 32750, htin = 0.15, label.cex = 1.2)
box()</code></pre>
<div class="figure" style="text-align: center">
<img src="Rmaps_files/figure-html/UWAutm1-1.png" alt="Figure 16. Map of the University of Western Australia Crawley campus showing scale, north arrow, and axes, and with the map projection changed from the OpenStreetMap default to Universal Transverse Mercator (UTM)." width="50%" />
<p class="caption">
Figure 16. Map of the University of Western Australia Crawley campus
showing scale, north arrow, and axes, and with the map projection
changed from the OpenStreetMap default to Universal Transverse Mercator
(UTM).
</p>
</div>
<p>The map in Figure 16 is now just what we need -- we know scale and
direction, and we have axes in the Universal Transverse Mercator (UTM)
projection with units of metres, which we would normally set up our
field GPS to show.</p>
</div>
</div>
<div id="final-words" class="section level2">
<h2>Final Words</h2>
<p>We recommend using either the <span
style="font-family: monospace; background-color: #e8e8e8;">maptiles</span>
or <span
style="font-family: monospace; background-color: #e8e8e8;">ggmap</span>
packages to draw maps with tiled backgrounds, as they allow use of the
state-of-the-art <em>simple features</em> system <em>via</em> the <span
style="font-family: monospace; background-color: #e8e8e8;">sf</span>
package.</p>
</div>
<div id="appendix---coordinate-conversions" class="section level2">
<h2>Appendix - coordinate conversions</h2>
<p><strong>Converting UTM to LongLat</strong></p>
<p>Make a simple features (package <span
style="font-family: monospace; background-color: #e8e8e8;">sf</span>)
object containing the UTM coordinates</p>
<p>Example uses explicit values (as used previously to generate the
<span
style="font-family: monospace; background-color: #e8e8e8;">maptiles</span>
map), but the coordinates could also be obtained from a data frame -
edit to suit!</p>
<pre class="r"><code>utm.temp &lt;- st_as_sf(data.frame(x=c(399800,400700),y=c(6467900,6468400)),
                     coords = c(&quot;x&quot;,&quot;y&quot;), crs = UTM50)</code></pre>
<p>We then use the <span
style="font-family: monospace; background-color: #e8e8e8;">st_transform()</span>
function from the <span
style="font-family: monospace; background-color: #e8e8e8;">sf</span>
package to convert to long-lat (or another projection), which results in
another spatial object:</p>
<pre class="r"><code>longlat.temp &lt;- st_transform(utm.temp, crs = LongLat)</code></pre>
<p>We now have two <span
style="font-family: monospace; background-color: #e8e8e8;">sf</span>
spatial objects which we can use (for instance) to define the map extent
for a <span
style="font-family: monospace; background-color: #e8e8e8;">maptiles</span>
map:</p>
<pre class="r"><code>require(sf); require(maptiles) # load packages if not done already
# using the utm object
tiles_utm &lt;- get_tiles(utm.temp, provider = &quot;OpenStreetMap&quot;, crop = TRUE)
# using the longitude-latitude object
tiles_longlat &lt;- get_tiles(longlat.temp, provider = &quot;OpenStreetMap&quot;,
                          crop = TRUE)
# . . . and so on</code></pre>
<p>To extract coordinates from a data frame, for example: <br>
(<strong>NOTE</strong> - missing coordinates are not allowed!)</p>
<pre class="r"><code>afs19 &lt;- afs19[-which(is.na(afs19[,c(&quot;Easting&quot;)])==1),] # remove rows with NAs
afs19utm &lt;-  st_as_sf(afs19, coords = c(&quot;Easting&quot;,&quot;Northing&quot;), crs = UTM50)</code></pre>
<p>We then use the <span
style="font-family: monospace; background-color: #e8e8e8;">st_transform()</span>
function from the <span
style="font-family: monospace; background-color: #e8e8e8;">sf</span>
package to convert to longitude-latitude, which results in another
spatial data frame:</p>
<pre class="r"><code>afs19ll &lt;- st_transform(afs19utm, crs = LongLat)</code></pre>
<p>To extract just the coordinate values in non-spatial form, we use the
function <span
style="font-family: monospace; background-color: #e8e8e8;">st_coordinates()</span>:</p>
<pre class="r"><code># extract sf coordinates to console (can assign to object of class &quot;matrix&quot;)
st_coordinates(afs19utm)

# extract sf coordinates to data frame
longlat.temp &lt;- as.data.frame(st_coordinates(afs19ll))
colnames(longlat.temp) &lt;- c(&quot;Longitude&quot;,&quot;Latitude&quot;)</code></pre>
<hr>
</div>
<div id="references-and-r-packages" class="section level2">
<h2>References and R packages</h2>
<p>Dunnington, Dewey (2017). prettymapr: Scale Bar, North Arrow, and
Pretty Margins in R. R package version 0.2.2. <a
href="https://CRAN.R-project.org/package=prettymapr"
class="uri">https://CRAN.R-project.org/package=prettymapr</a>.</p>
<p>Dunnington D (2022). <em>rosm: Plot Raster Map Tiles from Open Street
Map and</em> <em>Other Sources</em>. R package version 0.2.6, <a
href="https://CRAN.R-project.org/package=rosm"
class="uri">https://CRAN.R-project.org/package=rosm</a>.</p>
<p>Fellows, Ian and using the JMapViewer library by Jan Peter Stotz
(2019). <em>OpenStreetMap: Access to Open Street Map Raster Images</em>.
R package version 0.3.4. <a
href="https://CRAN.R-project.org/package=OpenStreetMap"
class="uri">https://CRAN.R-project.org/package=OpenStreetMap</a>.</p>
<p>Giraud T (2021). <em>maptiles: Download and Display Map Tiles</em>. R
package version 0.3.0, <a
href="https://CRAN.R-project.org/package=maptiles"
class="uri">https://CRAN.R-project.org/package=maptiles</a>.</p>
<p>Pebesma, E., 2018. Simple Features for R: Standardized Support for
Spatial VectorData. <em>The R Journal</em> <strong>10</strong> (1),
439-446, <a href="https://doi.org/10.32614/RJ-2018-009"
class="uri">https://doi.org/10.32614/RJ-2018-009</a>. (package
<strong>sf</strong>)</p>
<p>Pebesma, E.J., R.S. Bivand, 2005. Classes and methods for spatial
data in R. <em>R News</em> <strong>5</strong> (2), <a
href="https://cran.r-project.org/doc/Rnews/"
class="uri">https://cran.r-project.org/doc/Rnews/</a>. (package
<strong>sp</strong>)</p>
<hr>
<p><img src="Rmaps_files/figure-html/stamen%20watercolor-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
</div>

<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>










<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<hr />
<p><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank"><strong>CC-BY-SA</strong></a> • All content by Ratey-AtUWA. My employer does not necessarily know about or endorse the content of this website.<br>
<span style="font-size:9pt">Created with <span style="font-family: monospace; background-color: #e8e8e8;">rmarkdown</span> in <a href="https://www.rstudio.com/" target="_blank">RStudio</a> using the <span style="font-family: monospace; background-color: #e8e8e8;">darkly</span> theme from <a href="https://bootswatch.com/" target="_blank">Bootswatch</a> via the <span style="font-family: monospace; background-color: #e8e8e8;">bslib</span> package, and <a href="https://fontawesome.com/v5/search?o=r&m=free" target="_blank">fontawesome v5 icons</a>.</span></p>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
